# -------------------- Display settings --------------------
display_name: '&e[第二章]洞窟的詭譎傳聞'

start_notify:
  title: '&a任務開始'
  title_subtitle: '&7開始進行 &a{quest} &7任務'
  sound: ENTITY_PLAYER_LEVELUP

progress_notify:
  actionbar: '&a{quest} &7| {objective}'

all_status_item:
  type: END_CRYSTAL
  name: '&6{quest}'
  lore: |
    &#32027d&m           &r&7［任務報酬］&#32027d&m           
    &f- &e金幣&fx1000
    &f- &a經驗值&fx16900
    &f- &b物品-時裝布料&fx1
    &#32027d&m           &r&7［任務進度］&#32027d&m           {detailed_progression}
    &#32027d&m                                   
    &r&f{controls}

display_priority: 1

# -------------------- Post-quest settings --------------------

completion:
  max_completions: 1
  notify:
    SUCCESS:
      title: '&d任務完成'
      title_subtitle: '&7你完成了任務 &a{quest} &7!'
      sound: ENTITY_PLAYER_LEVELUP
      bossbar: >
        {quest} &a任務完成!
      bossbar_color: GREEN  # Values : BLUE, GREEN, PINK, PURPLE, RED, WHITE, YELLOW
      bossbar_style: SOLID  # Values : SOLID, SEGMENTED_6, SEGMENTED_10, SEGMENTED_12, SEGMENTED_20
      bossbar_flags: []  # Values : CREATE_FOG, DARKEN_SKY, PLAY_BOSS_MUSIC
      bossbar_duration: 10 SECOND
    FAIL:
      title: '&c任務失敗'
      title_subtitle: '&7你在任務 &c{quest} &7中失敗了!'
      sound: BLOCK_ANVIL_DESTROY
      bossbar: >
        {quest} &a任務失敗!
      bossbar_color: RED  # Values : BLUE, GREEN, PINK, PURPLE, RED, WHITE, YELLOW
      bossbar_style: SOLID  # Values : SOLID, SEGMENTED_6, SEGMENTED_10, SEGMENTED_12, SEGMENTED_20
      bossbar_flags: []  # Values : CREATE_FOG, DARKEN_SKY, PLAY_BOSS_MUSIC
      bossbar_duration: 10 SECOND
    CANCEL:
      title: '&c任務取消'
      title_subtitle: '&7你取消了任務 &c{quest}'
      sound: BLOCK_ANVIL_DESTROY
      bossbar: >
        {quest} &a任務取消!
      bossbar_color: PINK  # Values : BLUE, GREEN, PINK, PURPLE, RED, WHITE, YELLOW
      bossbar_style: SOLID  # Values : SOLID, SEGMENTED_6, SEGMENTED_10, SEGMENTED_12, SEGMENTED_20
      bossbar_flags: []  # Values : CREATE_FOG, DARKEN_SKY, PLAY_BOSS_MUSIC
      bossbar_duration: 10 SECOND

conditions_start_restriction:
  match_amount: 2
  conditions:
    1:
      type: QUEST_COMPLETED
      model: a_quest_07
    2:
      type: LOGIC
      logic: '%mmocore_level% >= 8'

# -------------------- Activator settings --------------------
activators: [cnpc437]

activators_dialog:
  - '&a<羅德> &f冒險兄弟，又有委託了! &d(右鍵點擊NPC來接取任務)'
  - ''

activators_dialog_auto_start_distance: 4

activators_dialog_reset:
  reset_delay: 5 SECOND
  reset_distance: 6.0

# -------------------- Main Quest Object --------------------

branches:

  main:
    starts_at: 0
    objects:

      0:
        type: PLAYER_CITIZENS_NPC_INTERACT
        objective_detail: '&f與&a<羅德#42>&f對話'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 1
        position:
          type: CITIZENS_NPC_RELATIVE_SINGLE
          npc: 437
        npc: 437
        start_notify:
          title: '&b任務提示'
          title_subtitle: '&b與&a<羅德#42>&f對話'
          message: '&#cff7fa&l[&#75f5ff&l任&#42f1ff&l務&#42f1ff&l系&#75f5ff&l統&#cff7fa&l] &f與&a<羅德#42>&f對話'
      
      1:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 2
        toggle: true

      2:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 3
        actions: 
          - 'SEND_MESSAGE &a<羅德> &f兄弟! 最近在漁村附近的洞窟突然有許多&5[怪異的不死族]&f進出'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f問題就是出在這裡，牠們並不是以襲擊人們為目的，我故意擋在牠面前他也沒有攻擊我'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f一直進進出出，似乎在做什麼事情...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
      
      3:
        type: DIVERGE_CHAT
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        choices:
          0:
            text: '&d&l[故事劇情] 按我選擇 >> &f[洞窟有不死族很正常啊？有什麼不對嗎？]'
            goto: OBJECT 4A
          1:
            text: '&d&l[故事劇情] 按我選擇 >> &f[難道是邪教場地？！]'
            goto: OBJECT 4B
      
      4A:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 5
        actions: 
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f洞窟有不死族很正常啊？有什麼不對嗎？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f這是因為你不是這裡的居民，你可能不知道'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &b[漁村附近的洞窟]&f不同於其他洞窟，那座洞窟不應該有&5不死族&f在裡面...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f因為在以前，&a[內湖營地的皇家禁衛軍隊長 炎鎮]&f早已把裡面的&5不死族&f全數殲滅。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f在殲滅&5不死族&f之後，漁村裡有流傳著許多洞穴的鬼故事。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f洞穴結構複雜的如迷宮般。上次有冒險者進去之後迷路，公會還特地發了委託去找人呢。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 60
          - 'SEND_MESSAGE &a<羅德> &f只不過很可惜，我們只看到裡面插滿了火把，沒有找到失蹤者...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40

      4B:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 5
        actions: 
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f難道是邪教場地？！'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f這我也不確定...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &b[漁村附近的洞窟]&f不同於其他洞窟，那座洞窟不應該有&5不死族&f在裡面...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f因為在以前，&a[內湖營地的皇家禁衛軍隊長 炎鎮]&f早已把裡面的&5不死族&f全數殲滅。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f在殲滅&5不死族&f之後，漁村裡有流傳著許多洞穴的鬼故事。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f洞穴結構複雜的如迷宮般。上次有冒險者進去之後迷路，公會還特地發了委託去找人呢。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 60
          - 'SEND_MESSAGE &a<羅德> &f只不過很可惜，我們只看到裡面插滿了火把，沒有找到失蹤者...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
      
      5:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 6
        actions: 
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[這次的委託該不會...]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f這次的委託該不會...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f很遺憾，你猜對了，這次的委託就是想麻煩你去裡面調查一下。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[等等，我需要注意什麼嗎？不然進去不就是找死...]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f等等，我需要注意什麼嗎？不然進去不就是找死...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f你需要注意... &a[一條線]&f。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[一條線？那是什麼？]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f一條線？那是什麼？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f不對，應該是&a[一組線]&f，嚴格來說是&a線圈&f。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f你可以去找&b[工匠]&f製作&a線圈&f，那東西可以用來&e標記&f與&e尋路&f。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &a線圈&f就是使用&a史萊姆球&f將&a線材&f黏合在一起，只需要一顆就能用很久。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[平原蜘蛛的蜘蛛絲可以拿來當線材嗎？]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f平原蜘蛛的蜘蛛絲可以拿來當線材嗎？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f可以，但風險很高，因為&a平原蜘蛛絲&f的結構不佳，很容易斷裂。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &b[故事劇情](你心想：試試看吧，這是我唯一有聽說過的線材了)'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT #WOOL
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &b[故事劇情](你心想：卡坦村的工匠&a<羅素>&f也許會製作線圈...)'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT #WOOL
          - WAIT_TICKS 40
      
      6:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 7
        toggle: false
      
      7:
        type: PLAYER_CITIZENS_NPC_DELIVER_ITEMS
        gps:
          enabled: false
        npc: 611
        objective_detail: '&f交付&a[平原蜘蛛絲]&f給&a<羅素#25> &b{objective_progression:0}&f/&b{objective_goal:0}'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
          - '&f步驟-2 &f交付&a[平原蜘蛛絲]&f給&a<羅素#25> &b{objective_progression:0}&f/&b{objective_goal:0}'
        goto: OBJECT 8
        goals:
          0:
            goal: 64
            take: true
            check: SameBase
            item:
              type: ghast_tear
              nbt:
                MMOITEMS_ITEM_TYPE: RPG_ITEM_MOB
                MMOITEMS_ITEM_ID: '平原蜘蛛絲'
        start_notify:
          title: '&b任務提示'
          title_subtitle: '&b交付&a[平原蜘蛛絲]&f給&a<羅素#25>'
          message: '&#cff7fa&l[&#75f5ff&l任&#42f1ff&l務&#42f1ff&l系&#75f5ff&l統&#cff7fa&l] &f交付&a[平原蜘蛛絲]&f給&a<羅素#25>'
      
      8:
        type: PLAYER_CITIZENS_NPC_DELIVER_ITEMS
        gps:
          enabled: false
        npc: 611
        objective_detail: '&f交付&a[史萊姆球]&f給&a<羅素#25> &b{objective_progression:0}&f/&b{objective_goal:0}'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
          - '&f步驟-2 &f交付&a[平原蜘蛛絲]&f給&a<羅素#25> &b64&f/&b64'
          - '&f步驟-3 &f交付&a[史萊姆球]&f給&a<羅素#25> &b{objective_progression:0}&f/&b{objective_goal:0}'
        goto: OBJECT 9
        goals:
          0:
            goal: 1
            take: true
            check: SameBase
            item:
              type: ghast_tear
              nbt:
                MMOITEMS_ITEM_TYPE: RPG_ITEM_MOB
                MMOITEMS_ITEM_ID: '史萊姆球'
        start_notify:
          title: '&b任務提示'
          title_subtitle: '&b交付&a[史萊姆球]&f給&a<羅素#25>'
          message: '&#cff7fa&l[&#75f5ff&l任&#42f1ff&l務&#42f1ff&l系&#75f5ff&l統&#cff7fa&l] &f交付&a[史萊姆球]&f給&a<羅素#25>'
      
      9:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 10
        toggle: true

      10:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
          - '&f步驟-2 &f交付&a[平原蜘蛛絲]&f給&a<羅素#25> &b64&f/&b64'
          - '&f步驟-3 &f交付&a[史萊姆球]&f給&a<羅素#25> &b1&f/&b1'
          - '&f步驟-4 &f與&a<羅素#25>&f對話'
        goto: OBJECT 11
        actions: 
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[&a[羅素先生]&f，可以麻煩你幫我做&a線圈&f嗎？]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f&a[羅素先生]&f，可以麻煩你幫我做&a線圈&f嗎？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f可以，看你這小子還算乖巧，我就幫你一把吧。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f但之後就要你自己做了喔，不要每次都麻煩我。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f首先是... 等等...？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f你要做&a線圈&f不是應該要有捆線圈的&e載體&f嗎'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[需要什麼？我再去收集...]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f需要什麼？我再去收集...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f不用...不用了，我這裡有別人多餘留下來的。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f我要開始做了喔! 首先，由於&a平原蜘蛛絲&f比較容易斷裂，所以需要把蜘蛛絲像這樣子雙股纏繞，加強結構...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f接著沾黏&a史萊姆黏液&f，再做一次，一條一條接下去.....'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &b[故事劇情](8小時之後...)'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 120
          - 'SEND_MESSAGE &a<羅素> &f搞定了!! 就是那麼簡單!!'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &b[故事劇情](你心想：我是有聽說過安格斯說他的合成速度很慢啦...)'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &b[故事劇情](你心想：但這也&c&l太慢了&b!!!!!!!!!!)'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f我很厲害吧，來，給你做好的成品。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &b[故事劇情](羅素以一種極慢的速度將成品交給你)'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 70
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[真的真的! 好厲害喔! 謝謝!&7(敷衍一下)&f]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f真的真的! 好厲害喔! 謝謝!&7(敷衍一下)'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅素> &f這就是細心!下次你自己會合成了吧。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<???> &7(小聲地說)真是的，這破材料害我為了加固耽擱了半天，要線圈好歹也拿個堅固點的線材吧...'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
      11:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: QUEST_SUCCESS_THEN_START a_quest_09
        toggle: false
end_objects:
  success:
    a:
      type: SERVER_COMMANDS_PERFORM
      commands: 
        - heal {player}
        - eco give {player} 1000
        - mmocore admin exp give {player} main 16900
        - mi give RPG_ITEM_MATERIAL 時裝布料 {player} 1
  cancel:
    1:
      type: SERVER_COMMANDS_PERFORM
      commands: ['compass stop {player}']
