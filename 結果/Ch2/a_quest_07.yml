# -------------------- Display settings --------------------
display_name: '&e[第二章]製作防具'

start_notify:
  title: '&a任務開始'
  title_subtitle: '&7開始進行 &a{quest} &7任務'
  sound: ENTITY_PLAYER_LEVELUP

progress_notify:
  actionbar: '&a{quest} &7| {objective}'

all_status_item:
  type: END_CRYSTAL
  name: '&6{quest}'
  lore: |
    &#32027d&m           &r&7［任務報酬］&#32027d&m           
    &f- &e金幣&fx700
    &f- &a經驗值&fx14400
    &f- &b物品-時裝布料&fx1
    &#32027d&m           &r&7［任務進度］&#32027d&m           {detailed_progression}
    &#32027d&m                                   
    &r&f{controls}

display_priority: 1

# -------------------- Post-quest settings --------------------

completion:
  max_completions: 1
  notify:
    SUCCESS:
      title: '&d任務完成'
      title_subtitle: '&7你完成了任務 &a{quest} &7!'
      sound: ENTITY_PLAYER_LEVELUP
      bossbar: >
        {quest} &a任務完成!
      bossbar_color: GREEN  # Values : BLUE, GREEN, PINK, PURPLE, RED, WHITE, YELLOW
      bossbar_style: SOLID  # Values : SOLID, SEGMENTED_6, SEGMENTED_10, SEGMENTED_12, SEGMENTED_20
      bossbar_flags: []  # Values : CREATE_FOG, DARKEN_SKY, PLAY_BOSS_MUSIC
      bossbar_duration: 10 SECOND
    FAIL:
      title: '&c任務失敗'
      title_subtitle: '&7你在任務 &c{quest} &7中失敗了!'
      sound: BLOCK_ANVIL_DESTROY
      bossbar: >
        {quest} &a任務失敗!
      bossbar_color: RED  # Values : BLUE, GREEN, PINK, PURPLE, RED, WHITE, YELLOW
      bossbar_style: SOLID  # Values : SOLID, SEGMENTED_6, SEGMENTED_10, SEGMENTED_12, SEGMENTED_20
      bossbar_flags: []  # Values : CREATE_FOG, DARKEN_SKY, PLAY_BOSS_MUSIC
      bossbar_duration: 10 SECOND
    CANCEL:
      title: '&c任務取消'
      title_subtitle: '&7你取消了任務 &c{quest}'
      sound: BLOCK_ANVIL_DESTROY
      bossbar: >
        {quest} &a任務取消!
      bossbar_color: PINK  # Values : BLUE, GREEN, PINK, PURPLE, RED, WHITE, YELLOW
      bossbar_style: SOLID  # Values : SOLID, SEGMENTED_6, SEGMENTED_10, SEGMENTED_12, SEGMENTED_20
      bossbar_flags: []  # Values : CREATE_FOG, DARKEN_SKY, PLAY_BOSS_MUSIC
      bossbar_duration: 10 SECOND

conditions_start_restriction:
  match_amount: 2
  conditions:
    1:
      type: QUEST_COMPLETED
      model: a_quest_06
    2:
      type: LOGIC
      logic: '%mmocore_level% >= 7'

# -------------------- Activator settings --------------------
activators: [cnpc437]

activators_dialog:
  - '&a<羅德> &f直男兄弟! 我幫你留了一個委託，要看看嗎？ &d(右鍵點擊NPC來接取任務)'
  - ''

activators_dialog_auto_start_distance: 4

activators_dialog_reset:
  reset_delay: 5 SECOND
  reset_distance: 6.0

# -------------------- Main Quest Object --------------------

branches:

  main:
    starts_at: 0
    objects:

      0:
        type: PLAYER_CITIZENS_NPC_INTERACT
        objective_detail: '&f與&a<羅德#42>&f對話'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 1
        position:
          type: CITIZENS_NPC_RELATIVE_SINGLE
          npc: 437
        npc: 437
        start_notify:
          title: '&b任務提示'
          title_subtitle: '&b與&a<羅德#42>&f對話'
          message: '&#cff7fa&l[&#75f5ff&l任&#42f1ff&l務&#42f1ff&l系&#75f5ff&l統&#cff7fa&l] &f與&a<羅德#42>&f對話'

      1:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 2
        toggle: true

      2:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 3
        actions:
          - 'SEND_MESSAGE &a<羅德> &f你終於來了嗎？我的直男好兄弟？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f你來得正好，我剛剛留了一個很重要但簡單的委托給你了。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40

      3:
        type: DIVERGE_CHAT
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        choices:
          0:
            text: '&d&l[故事劇情] 按我選擇 >> &f[對我這麼好的嗎？]'
            goto: OBJECT 4A
          1:
            text: '&d&l[故事劇情] 按我選擇 >> &f[真是謝謝你，我的好兄弟!]'
            goto: OBJECT 4B
            
      4A:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 5
        actions:
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f對我這麼好的嗎？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f當然了，看在你有趣的份上，留給你的，哈哈'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f這次的委托內容是交付三件&a[Lv5冒險者上衣]&f。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f你可以去找&a[鐵匠]&f就能知道裝備的製作配方。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40

      4B:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 5
        actions:
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f真是謝謝你，我的好兄弟!'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f當然了，我的直男好兄弟，這是留給你的，哈哈'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f兄弟，這次的委托內容是交付三件&a[Lv5冒險者上衣]&f。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f你可以去找&a[鐵匠]&f就能知道裝備的製作配方。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
            
      5:
        type: SERVER_ACTIONS
        objective_detail: '&f---&r&6[&b主線劇情進行中，請細心欣賞劇情!&6]&f---'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
        goto: OBJECT 6
        actions:
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[沒問題，但為什麼是&a[冒險者上衣]&f？]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f沒問題，但為什麼是&a[冒險者上衣]&f？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f因為這附近有許多具攻擊性的生物'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f為了防止村民在進出村莊時受到襲擊，需要採取預防措施。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f如果遇到熊還好，但如果碰上不死族就有麻煩了。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f所以我們冒險者公會會發給這裡的村民裝備，保險一點，免得他們受了重傷。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'PROMPT_NEXT &d&l[故事劇情] 按我選擇 >> &f[既然這裡很危險，那為什麼還要住在這裡？]'
          - 'SEND_MESSAGE &f<%luckperms_prefix%{player}%luckperms_suffix%&f> &f既然這裡很危險，那為什麼還要住在這裡？'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f哈哈，兄弟，這裡作為一個小小的避風塘，不僅地勢優越，能保護船隻'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f而且附近的水域還有一大堆漁獲，生活的可不錯呢!'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f最重要的是，這裡不會像&b[新月城]&f樣有觀光和商業用船來回晃悠'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f反而令這裡别有一番風味。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f回到正題，麻煩你幫我製作冒險者上衣吧!'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40

      6:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 7
        toggle: false
          
      7:
        type: PLAYER_CITIZENS_NPC_DELIVER_ITEMS
        gps:
          enabled: false
        npc: 437
        objective_detail: '&f交付&a[冒險者上衣]&f給&a<羅德#42> &b{objective_progression:0}&f/&b{objective_goal:0}'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
          - '&f步驟-2 &f交付&a[冒險者上衣]&f給&a<羅德#42> &b{objective_progression:0}&f/&b{objective_goal:0}'
        goto: OBJECT 8
        goals:
          0:
            goal: 3
            take: true
            check: SameBase
            item:
              type: iron_chestplate
              nbt:
                MMOITEMS_ITEM_TYPE: RPG_ARMOR
                MMOITEMS_ITEM_ID: '冒險者上衣'
        start_notify:
          title: '&b任務提示'
          title_subtitle: '&b交付&a[冒險者上衣]&f給&a<羅德#42>'
          message: '&#cff7fa&l[&#75f5ff&l任&#42f1ff&l務&#42f1ff&l系&#75f5ff&l統&#cff7fa&l] &f交付&a[冒險者上衣]&f給&a<羅德#42>'

      8:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 9
        toggle: true

      9:
        type: SERVER_ACTIONS
        objective_detail: '&a<羅德>&f正在與你對話'
        objective_detail_verbose: 
          - '&f步驟-1 &f與&a<羅德#42>&f對話'
          - '&f步驟-2 &f交付&a[冒險者上衣]&f給&a<羅德#42> &b3&f/&b3'
          - '&f步驟-3 &f與&a<羅德#42>&f對話'
        goto: OBJECT 10
        actions:
          - 'SEND_MESSAGE &a<羅德> &f動作很快嘛!謝謝你。'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f我看你也沒有裝備，我送你一件吧!'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &a<羅德> &f出門在外冒險要小心喔!'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40

      10:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: QUEST_SUCCESS_THEN_START a_quest_08
        toggle: false

end_objects:
  success:
    a:
      type: SERVER_COMMANDS_PERFORM
      commands: 
        - heal {player}
        - eco give {player} 700
        - mmocore admin exp give {player} main 14400
        - mi give RPG_ITEM_MATERIAL 時裝布料 {player} 1
        - mi give RPG_ARMOR 冒險者盔甲 {player} 1
  cancel:
    1:
      type: SERVER_COMMANDS_PERFORM
      commands: ['compass stop {player}']