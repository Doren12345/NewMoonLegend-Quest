# -------------------- Display settings --------------------

display_name: '&e[主線]上山調查'

start_notify:
  title: '&a任務開始'
  title_subtitle: '&7開始進行 &a{quest} &7任務'
  sound: ENTITY_PLAYER_LEVELUP

progress_notify:
  actionbar: '&a{quest} &7| {objective}'

all_status_item:
  type: END_CRYSTAL
  name: '&6{quest}'
  lore: |-
    &f--------------------
    &f任務報酬：
    &f- &e金幣&fx1000
    &f- &a總經驗值&fx67600
    &f--------------------{detailed_progression}
    {controls}

# -------------------- Post-quest settings --------------------

completion:
  notify:
    SUCCESS:
      title: '&d任務完成'
      title_subtitle: '&7你完成了任務 &a{quest} &7!'
      sound: ENTITY_PLAYER_LEVELUP
      message:
        - '&f--------------------'
        - '&f解鎖&e[主線]炎鎮的訓練'
        - '&f可在&a[內湖營地]&f向&a<炎鎮>&f接取'
        - '&f--------------------'
        - '&f需要滿足以下條件才能接取任務：'
        - '&a等級：Lv22'
        - '&f--------------------'
    FAIL:
      title: '&cQuest failed'
      title_subtitle: '&7You failed quest &c{quest} &7!'
      sound: BLOCK_ANVIL_DESTROY
    CANCEL:
      title: '&c任務取消'
      title_subtitle: '&7你取消了任務 &c{quest}'
      sound: BLOCK_ANVIL_DESTROY

activators: [cnpc60]

conditions_start_restriction:
  match_amount: 2
  conditions:
    1:
      type: LOGIC
      logic: '%mmocore_level% >= 21'
    2:
      type: QUEST_COMPLETED
      model: a_quest_20

display_priority: 1

branches:

  main:
    starts_at: 1
    objects:

      1:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 2
        toggle: true

      2:
        type: SERVER_ACTIONS
        objective_detail: '&a<炎鎮>&f正在與你對話'
        objective_detail_verbose: '&f步驟-1 &f與&a<炎鎮#65>&f對話'
        goto: OBJECT 3
        actions:
          - 'SEND_MESSAGE &e[1/3]&a<炎鎮> &f如果出現的是真正的不死族'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[2/3]&a<炎鎮> &f那我們必須要做好防禦'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[3/3]&a<炎鎮> &f請你先到弟兄發現不死族的位置調查'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          
      3:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 4
        toggle: false
        
      4:
        type: PLAYER_POSITION
        objective_detail: '&a前往調查(-1304,159,-260)'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
        goto: OBJECT 5
        position:
          type: SPHERE_INSIDE
          radius: 5
          center: world,-1304,159,-260
          
      5:
        type: SERVER_ACTIONS
        objective_detail: '&a前往調查(-1304,159,-260)'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
        goto: OBJECT 6
        actions:
          - 'SEND_MESSAGE &b[故事劇情](這裡好像沒有,再去前面看看看吧)'
          - WAIT_TICKS 40
          
      6:
        type: PLAYER_POSITION
        objective_detail: '&a前往調查(-1259,118,-73)'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
        goto: OBJECT 7
        position:
          type: SPHERE_INSIDE
          radius: 5
          center: world,-1259,118,-73
          
      7:
        type: SERVER_ACTIONS
        objective_detail: '&a前往調查(-1304,159,-260)'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
        goto: OBJECT 8
        actions:
          - 'SEND_MESSAGE &b[故事劇情](這裡有一些骨頭,難道是不死族的足跡!?)'
          - WAIT_TICKS 40
          
      8:
        type: PLAYER_CITIZENS_NPC_INTERACT
        objective_detail: '&f與&a<炎鎮#65>&f對話'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
          - '&f步驟-4 &f與&a<炎鎮#65>&f對話'
        goto: OBJECT 9
        position:
          type: CITIZENS_NPC_RELATIVE_SINGLE
          npc: 60
        npc: 60
        start_notify:
          title: '&b任務提示'
          title_subtitle: '&b與&a<炎鎮#65>&f對話'
          message: '&#cff7fa&l[&#75f5ff&l任&#42f1ff&l務&#42f1ff&l系&#75f5ff&l統&#cff7fa&l] &f與&a<炎鎮#65>&f對話'
          
      9:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: OBJECT 10
        toggle: true

      10:
        type: SERVER_ACTIONS
        objective_detail: '&a<炎鎮>&f正在與你對話'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
          - '&f步驟-4 &f與&a<炎鎮#65>&f對話'
        goto: OBJECT 11
        actions:
          - 'SEND_MESSAGE &e[1/4]&a<炎鎮> &f的確,之前我在追逐不死族的殘黨時'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[2/4]&a<炎鎮> &f我也是跟隨它們跌落的骨頭'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[3/4]&a<炎鎮> &f那看來可以確定不死族真的來到內湖營地附近了'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[4/4]&a<炎鎮> &f甚至乎在斷骨山脈上建立了領地'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40

      11:
        type: DIVERGE_CHAT
        objective_detail: '&f回應&a<炎鎮>'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
          - '&f步驟-4 &f與&a<炎鎮#65>&f對話'
        choices:
          0:
            text: '&d&l[故事劇情] 按我選擇 >> [為什麼會來到斷骨山脈建立?]'
            goto: OBJECT 12
            
      12:
        type: SERVER_ACTIONS
        objective_detail: '&a<炎鎮>&f正在與你對話'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
          - '&f步驟-4 &f與&a<炎鎮#65>&f對話'
        goto: OBJECT 13
        actions:
          - 'SEND_MESSAGE &e[1/7]&a<炎鎮> &f這就跟黑龍出現時有關了'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[2/7]&a<炎鎮> &f曾經有一群黑魔法師使用禁忌魔法令死者復活'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[3/7]&a<炎鎮> &f其中復活了死靈法師&5[弗拉梅爾]'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[4/7]&a<炎鎮> &f傳說沒有人見過&5[弗拉梅爾]&f直接戰鬥的樣子'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[5/7]&a<炎鎮> &f因為和&5[弗拉梅爾]&f戰鬥後的人都不能活下來'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[6/7]&a<炎鎮> &5[弗拉梅爾]&f具有和亡者溝通,甚至召喚不死族出現'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[7/7]&a<炎鎮> &f傳說的最後,&5[弗拉梅爾]&f是死在雪山裡的'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40

      13:
        type: DIVERGE_CHAT
        objective_detail: '&f回應&a<炎鎮>'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
          - '&f步驟-4 &f與&a<炎鎮#65>&f對話'
        choices:
          0:
            text: '&d&l[故事劇情] 按我選擇 >> [那怎麼辦?]'
            goto: OBJECT 14
            
      14:
        type: SERVER_ACTIONS
        objective_detail: '&a<炎鎮>&f正在與你對話'
        objective_detail_verbose:
          - '&f步驟-1 &f與&a<炎鎮#65>&f對話'
          - '&f步驟-2 &a前往調查(-1304,159,-260)'
          - '&f步驟-3 &a前往調查(-1259,118,-73)'
          - '&f步驟-4 &f與&a<炎鎮#65>&f對話'
        goto: OBJECT 15
        actions:
          - 'SEND_MESSAGE &e[1/5]&a<炎鎮> &f現在能確定的就只有雪山上有不死族的足跡'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[2/5]&a<炎鎮> &f是不是和&5[弗拉梅爾]&f有關也不知道'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[3/5]&a<炎鎮> &f我已經通知了所有弟兄'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[4/5]&a<炎鎮> &f讓他們好好鎮守自己的崗位'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          - 'SEND_MESSAGE &e[5/5]&a<炎鎮> &f並且不要勉強行事,你也要小心'
          - SEND_SOUND ENTITY_VILLAGER_AMBIENT
          - WAIT_TICKS 40
          
      15:
        type: SERVER_CAMERA_MODE_TOGGLE
        goto: QUEST_SUCCESS
        toggle: false
            
end_objects:
  success:
    a:
      type: SERVER_COMMANDS_PERFORM
      commands:
        - eco give {player} 1000
        - mmocore admin exp give {player} farm 67600
        - mmocore admin exp give {player} fishing 67600
        - mmocore admin exp give {player} food 67600
        - mmocore admin exp give {player} handicraft 67600
        - mmocore admin exp give {player} main 67600
        - mmocore admin exp give {player} mining 67600
        - mmocore admin exp give {player} alchemy 67600
  cancel:
    1:
      type: SERVER_COMMANDS_PERFORM
      commands: ['compass stop {player}']